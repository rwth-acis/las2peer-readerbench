<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="de"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReaderbenchService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">readerbench</a> &gt; <a href="index.source.html" class="el_package">i5.las2peer.services.readerbenchService</a> &gt; <span class="el_source">ReaderbenchService.java</span></div><h1>ReaderbenchService.java</h1><pre class="source lang-java linenums">package i5.las2peer.services.readerbenchService;

import java.io.IOException;
import java.net.HttpURLConnection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.Arrays;
import java.util.*;

import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.entity.StringEntity;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.HttpClientBuilder;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.util.EntityUtils;

import java.util.*;
import java.util.HashSet;

import javax.ws.rs.GET;
import javax.ws.rs.POST;
import javax.ws.rs.Path;
import javax.ws.rs.PathParam;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;
import javax.ws.rs.core.Response.Status;

import com.google.gson.Gson;

import i5.las2peer.api.Context;
import i5.las2peer.api.security.UserAgent;
import i5.las2peer.api.logging.MonitoringEvent;
import i5.las2peer.restMapper.RESTService;
import i5.las2peer.restMapper.annotations.ServicePath;
import i5.las2peer.services.readerbenchService.model.MessageInfo;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import io.swagger.annotations.ApiResponse;
import io.swagger.annotations.ApiResponses;
import io.swagger.annotations.Contact;
import io.swagger.annotations.Info;
import io.swagger.annotations.License;
import io.swagger.annotations.SwaggerDefinition;
import net.minidev.json.JSONArray;
import net.minidev.json.JSONObject;
import net.minidev.json.parser.JSONParser;
import net.minidev.json.parser.ParseException;



// TODO Describe your own service
/**
 * las2peer-Template-Service
 * 
 * This is a template for a very basic las2peer service that uses the las2peer WebConnector for RESTful access to it.
 * 
 * Note: If you plan on using Swagger you should adapt the information below in the SwaggerDefinition annotation to suit
 * your project. If you do not intend to provide a Swagger documentation of your service API, the entire Api and
 * SwaggerDefinition annotation should be removed.
 * 
 */
// TODO Adjust the following configuration
@Api
@SwaggerDefinition(
		info = @Info(
				title = &quot;las2peer Readerbench Service&quot;,
				version = &quot;1.0.0&quot;,
				description = &quot;A las2peer Template Service for Readerbench purposes.&quot;,
				contact = @Contact(
						name = &quot;Karly Zeufack&quot;,
						url = &quot;https://las2peer.org&quot;,
						email = &quot;karl.zeufack@rwth-aachen.de&quot;),
				license = @License(
						name = &quot;BSD-3&quot;,
						url = &quot;https://github.com/Karlydiamond214/las2peer-readerbench&quot;)))
@ServicePath(&quot;/readerbench&quot;)
// TODO Your own service class
<span class="fc" id="L83">public class ReaderbenchService extends RESTService {</span>

<span class="fc" id="L85">	private final static List&lt;String&gt; SUPPORTED_FUNCTIONS = Arrays.asList(&quot;textual coomplexity&quot;,</span>
			&quot;Sentiment&quot;);

<span class="fc" id="L88">	private static HashMap&lt;String, Object&gt; ContextInfo = new HashMap&lt;String, Object&gt;();</span>

	/**
	 * Template of a get function.
	 * 
	 * @return Returns an HTTP response with the username as string content.
	 */
	@GET
	@Path(&quot;/get&quot;)
	@Produces(MediaType.TEXT_PLAIN)
	@ApiOperation(
			value = &quot;REPLACE THIS WITH AN APPROPRIATE FUNCTION NAME&quot;,
			notes = &quot;REPLACE THIS WITH YOUR NOTES TO THE FUNCTION&quot;)
	@ApiResponses(
			value = { @ApiResponse(
					code = HttpURLConnection.HTTP_OK,
					message = &quot;REPLACE THIS WITH YOUR OK MESSAGE&quot;) })
	public Response getTemplate() {
<span class="fc" id="L106">		UserAgent userAgent = (UserAgent) Context.getCurrent().getMainAgent();</span>
<span class="fc" id="L107">		String name = userAgent.getLoginName();</span>
<span class="fc" id="L108">		return Response.ok().entity(name).build();</span>
	}

	/**
	 * Template of a post function.
	 * 
	 * @param myInput The post input the user will provide.
	 * @return Returns an HTTP response with plain text string content derived from the path input param.
	 */
	@POST
	@Path(&quot;/post/{input}&quot;)
	@Produces(MediaType.TEXT_PLAIN)
	@ApiResponses(
			value = { @ApiResponse(
					code = HttpURLConnection.HTTP_OK,
					message = &quot;REPLACE THIS WITH YOUR OK MESSAGE&quot;) })
	@ApiOperation(
			value = &quot;REPLACE THIS WITH AN APPROPRIATE FUNCTION NAME&quot;,
			notes = &quot;Example method that returns a phrase containing the received input.&quot;)
	public Response postTemplate(@PathParam(&quot;input&quot;) String myInput) {
<span class="fc" id="L128">		String returnString = &quot;&quot;;</span>
<span class="fc" id="L129">		returnString += &quot;Input &quot; + myInput;</span>
<span class="fc" id="L130">		return Response.ok().entity(returnString).build();</span>
	}

	// TODO your own service methods, e. g. for RMI

	/**
	 * Template of a get function.
	 * 
	 * @return Returns an HTTP response with the username as string content.
	 */
	@GET
	@Path(&quot;/getSrvStatus&quot;)
	@Produces(MediaType.APPLICATION_JSON)
	@ApiOperation(
			value = &quot;REPLACE THIS WITH AN APPROPRIATE FUNCTION NAME&quot;,
			notes = &quot;REPLACE THIS WITH YOUR NOTES TO THE FUNCTION&quot;)
	@ApiResponses(
			value = { @ApiResponse(
					code = HttpURLConnection.HTTP_OK,
					message = &quot;REPLACE THIS WITH YOUR OK MESSAGE&quot;) })
	public Response getSrvStatus() {
<span class="nc" id="L151">		JSONObject j = new JSONObject();</span>
<span class="nc" id="L152">		j.put(&quot;text&quot;, &quot;service alive&quot;);</span>
<span class="nc" id="L153">		j.put(&quot;closeContext&quot;, true);</span>
<span class="nc" id="L154">		String status = &quot;alive---------------&quot;;</span>
<span class="nc" id="L155">		return Response.ok().entity(j).build();</span>
	}


	@GET
	@Path(&quot;/getRbStatus&quot;)
	@Produces(MediaType.APPLICATION_JSON)
	@ApiOperation(
			value = &quot;REPLACE THIS WITH AN APPROPRIATE FUNCTION NAME&quot;,
			notes = &quot;REPLACE THIS WITH YOUR NOTES TO THE FUNCTION&quot;)
	@ApiResponses(
			value = { @ApiResponse(
					code = HttpURLConnection.HTTP_OK,
					message = &quot;REPLACE THIS WITH YOUR OK MESSAGE&quot;) })
	public Response getRbStatus() {
<span class="nc" id="L170">		JSONObject j = new JSONObject();</span>
<span class="nc" id="L171">		System.out.println(&quot;Breakpoint--------getRbStatus from Service--------------------------&quot;);</span>
		try {
			//Creating a HttpClient object
<span class="nc" id="L174">			CloseableHttpClient httpclient = HttpClients.createDefault();</span>
			//Creating a HttpGet object
<span class="nc" id="L176">			HttpGet httpget = new HttpGet(&quot;http://192.168.56.1:6006/api/v1/isalive&quot;);</span>

			//Printing the method used
<span class="nc" id="L179">			System.out.println(&quot;Request Type: &quot;+ httpget.getMethod());</span>

			//Executing the Get request
<span class="nc" id="L182">			HttpResponse response = httpclient.execute(httpget);</span>
<span class="nc" id="L183">			HttpEntity entity = response.getEntity();</span>
<span class="nc" id="L184">			String result = EntityUtils.toString(entity);</span>
<span class="nc" id="L185">			JSONObject j1 = new JSONObject();</span>
<span class="nc" id="L186">			j1.put(&quot;text&quot;, result);</span>
<span class="nc" id="L187">			j1.put(&quot;closeContext&quot;, true);</span>
<span class="nc" id="L188">			return Response.ok().entity(j1).build();</span>
<span class="nc" id="L189">		}catch (IOException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L191">			e.printStackTrace();</span>
<span class="nc" id="L192">			return Response.status(Status.BAD_REQUEST).entity(e.getMessage()).build();</span>
		}
	}


	/*
	@POST
	@Path(&quot;/text-similarity&quot;)
	@Produces(MediaType.TEXT_PLAIN)
	@ApiResponses(
			value = { @ApiResponse(
					code = HttpURLConnection.HTTP_OK,
					message = &quot;REPLACE THIS WITH YOUR OK MESSAGE&quot;) })
	@ApiOperation(
			value = &quot;REPLACE THIS WITH AN APPROPRIATE FUNCTION NAME&quot;,
			notes = &quot;Example method that returns a phrase containing the received input.&quot;)
	public Response textsimilarity(String categorie, String language, String corpus) {
		JSONObject j = new JSONObject();
		j.put(&quot;language&quot;, &quot;en&quot;);
		//j.put(&quot;texts&quot;, texts);
		j.put(&quot;corpus&quot;, corpus);
		try {
			StringEntity entity = new StringEntity(j.toString());
			HttpClient httpClient = HttpClientBuilder.create().build();
	        HttpPost request = new HttpPost(&quot;http://192.168.56.1:6006/api/v1/text-similarity&quot;);
	        request.setEntity(entity);
	        HttpResponse response = httpClient.execute(request);
	        HttpEntity entity2 = response.getEntity();
		    String result = EntityUtils.toString(entity2);
		    System.out.println(&quot;................&quot;+result);
		    return Response.ok().entity(result).build();
		}catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			return Response.status(Status.BAD_REQUEST).entity(e.getMessage()).build();
		}
	}
	 */
	@POST
	@Path(&quot;/feedback&quot;)
	@Produces(MediaType.APPLICATION_JSON)
	@ApiResponses(
			value = { @ApiResponse(
					code = HttpURLConnection.HTTP_OK,
					message = &quot;Feedback has been preceded&quot;) })
	@ApiOperation(
			value = &quot;REPLACE THIS WITH AN APPROPRIATE FUNCTION NAME&quot;,
			notes = &quot;Example method that returns a phrase containing the received input.&quot;)
	public Response feedback(String body) {
<span class="nc" id="L241">		Gson gson = new Gson();</span>
<span class="nc" id="L242">		MessageInfo m = gson.fromJson(body, MessageInfo.class);</span>
<span class="nc" id="L243">		System.out.println(&quot;Got message: &quot; + m.msg() + &quot; From Bot&quot; + m.botName());</span>
<span class="nc" id="L244">		String text = m.msg();</span>
<span class="nc" id="L245">		System.out.println(&quot;Breakpoint--------1------------------&quot;+ body);</span>
<span class="nc" id="L246">		JSONObject j = new JSONObject();</span>
<span class="nc" id="L247">		j.put(&quot;language&quot;, &quot;en&quot;);</span>
<span class="nc" id="L248">		j.put(&quot;text&quot;, text);</span>
		try {
<span class="nc" id="L250">			StringEntity entity = new StringEntity(j.toString());</span>
<span class="nc" id="L251">			HttpClient httpClient = HttpClientBuilder.create().build();</span>
<span class="nc" id="L252">			HttpPost request = new HttpPost(&quot;http://192.168.56.1:6006/api/v1/feedback&quot;);</span>
<span class="nc" id="L253">			request.setEntity(entity);</span>
<span class="nc" id="L254">			HttpResponse response = httpClient.execute(request);</span>
<span class="nc" id="L255">			HttpEntity entity2 = response.getEntity();</span>
<span class="nc" id="L256">			String result = EntityUtils.toString(entity2);</span>
<span class="nc" id="L257">			System.out.println(&quot;................result computed from readerbench................&quot;);</span>




<span class="nc" id="L262">			JSONObject j1 = new JSONObject();</span>
<span class="nc" id="L263">			j1.put(&quot;text&quot;, result);</span>
<span class="nc" id="L264">			j1.put(&quot;closeContext&quot;, true);</span>
<span class="nc" id="L265">			return Response.ok().entity(j1).build();</span>
<span class="nc" id="L266">		}catch (IOException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L268">			e.printStackTrace();</span>
<span class="nc" id="L269">			return Response.status(Status.BAD_REQUEST).entity(e.getMessage()).build();</span>
		}
	}

	@POST
	@Path(&quot;/textual_complexity&quot;)
	@Produces(MediaType.APPLICATION_JSON)
	@ApiResponses(
			value = { @ApiResponse(
					code = HttpURLConnection.HTTP_OK,
					message = &quot;REPLACE THIS WITH YOUR OK MESSAGE&quot;) })
	@ApiOperation(
			value = &quot;REPLACE THIS WITH AN APPROPRIATE FUNCTION NAME&quot;,
			notes = &quot;Example method that returns a phrase containing the received input.&quot;)
	public Response textualComplexity(String body) {
<span class="nc" id="L284">		JSONParser p = new JSONParser(JSONParser.MODE_PERMISSIVE);</span>
<span class="nc" id="L285">		JSONObject chatResponse = new JSONObject();</span>
<span class="nc" id="L286">		final long start = System.currentTimeMillis();</span>
<span class="nc" id="L287">		JSONObject event = new JSONObject();</span>
<span class="nc" id="L288">		System.out.println(&quot;Body &quot; + body);</span>
		try {
<span class="nc" id="L290">			JSONObject bodyJson = (JSONObject) p.parse(body);</span>
			String text;
<span class="nc" id="L292">			String email = bodyJson.getAsString(&quot;email&quot;);</span>
<span class="nc" id="L293">			JSONObject context = getContext(email, p);</span>
<span class="nc" id="L294">			String intent = bodyJson.getAsString(&quot;intent&quot;);</span>
<span class="nc" id="L295">			System.out.println(&quot;Context &quot; + context);</span>
<span class="nc" id="L296">		    event.put(&quot;email&quot;, email);</span>
<span class="nc" id="L297">			event.put(&quot;task&quot;, &quot;textualComplexity&quot;);</span>

<span class="nc" id="L299">			System.out.println(&quot;................&quot;+intent+&quot;................&quot;);</span>
<span class="nc bnc" id="L300" title="All 7 branches missed.">			switch (intent) {</span>
			case &quot;quit&quot;:
<span class="nc" id="L302">				chatResponse.put(&quot;text&quot;, &quot;Okay Aufwiedersehen.&quot;);</span>
<span class="nc" id="L303">				chatResponse.put(&quot;closeContext&quot;, true);</span>
<span class="nc" id="L304">				return Response.ok(chatResponse).build();</span>
			case &quot;text&quot;:
<span class="nc" id="L306">				text = bodyJson.getAsString(&quot;msg&quot;);</span>
<span class="nc" id="L307">				JSONObject j = new JSONObject();</span>
<span class="nc" id="L308">				j.put(&quot;language&quot;, &quot;en&quot;);</span>
<span class="nc" id="L309">				j.put(&quot;text&quot;, text);</span>
				try {
<span class="nc" id="L311">					StringEntity entity = new StringEntity(j.toString());</span>
<span class="nc" id="L312">					HttpClient httpClient = HttpClientBuilder.create().build();</span>
<span class="nc" id="L313">					HttpPost request = new HttpPost(&quot;http://192.168.56.1:6006/api/v1/textual-complexity&quot;);</span>
<span class="nc" id="L314">					request.setEntity(entity);</span>
<span class="nc" id="L315">					HttpResponse response = httpClient.execute(request);</span>
<span class="nc" id="L316">					HttpEntity entity2 = response.getEntity();</span>
<span class="nc" id="L317">					String result = EntityUtils.toString(entity2);</span>
<span class="nc bnc" id="L318" title="All 2 branches missed.">					if (context.getAsString(&quot;result&quot;) != null) {</span>
<span class="nc" id="L319">						context.remove(&quot;result&quot;);</span>
					}
<span class="nc" id="L321">					context.put(&quot;result&quot;, result);</span>
<span class="nc" id="L322">					ContextInfo.put(email, context);</span>
<span class="nc" id="L323">					System.out.println(&quot;................result computed from readerbench................&quot;);  </span>
<span class="nc" id="L324">					chatResponse.put(&quot;closeContext&quot;, false);</span>
<span class="nc" id="L325">					String res = selectCategoryMsg();</span>
<span class="nc" id="L326">					chatResponse.put(&quot;text&quot;,res);</span>
<span class="nc" id="L327">					return Response.ok().entity(chatResponse).build();</span>
<span class="nc" id="L328">				}catch (IOException e) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L330">					e.printStackTrace();</span>
<span class="nc" id="L331">					throw new ChatException(</span>
<span class="nc" id="L332">							e.getMessage()</span>
							);
				}


			case &quot;category&quot;:
<span class="nc" id="L338">				String category =  bodyJson.getAsString(&quot;category_option&quot;);</span>
<span class="nc bnc" id="L339" title="All 2 branches missed.">				if(category == null) {</span>
<span class="nc" id="L340">					throw new ChatException(</span>
							&quot;Aspekte wurde nicht erkannt. Bitte neue angeben&quot;
							);

				}
				else {
<span class="nc bnc" id="L346" title="All 2 branches missed.">					if (context.getAsString(&quot;category&quot;) != null) {</span>
<span class="nc" id="L347">						context.remove(&quot;category&quot;);</span>
					}
<span class="nc" id="L349">					context.put(&quot;category&quot;, category);</span>
<span class="nc" id="L350">					ContextInfo.put(email, context);</span>
				}
<span class="nc" id="L352">				String res = selectLevelMsg();</span>
<span class="nc" id="L353">				chatResponse.put(&quot;text&quot;,res);</span>
<span class="nc" id="L354">				chatResponse.put(&quot;closeContext&quot;, false);</span>
<span class="nc" id="L355">				return Response.ok().entity(chatResponse).build();</span>
			case &quot;level&quot;:
<span class="nc" id="L357">				String level =  bodyJson.getAsString(&quot;level_option&quot;);</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">				if(level == null) {</span>
<span class="nc" id="L359">					throw new ChatException(</span>
							&quot;Shicht wurde nicht erkannt. Bitte wieder angeben&quot;
							);
				}
				else {
<span class="nc bnc" id="L364" title="All 2 branches missed.">					if (context.getAsString(&quot;level&quot;) != null) {</span>
<span class="nc" id="L365">						context.remove(&quot;level&quot;);</span>
					}
<span class="nc" id="L367">					context.put(&quot;level&quot;, level);</span>
<span class="nc" id="L368">					ContextInfo.put(email, context);</span>
				}
<span class="nc" id="L370">				String category1 = context.getAsString(&quot;category&quot;);</span>
<span class="nc" id="L371">				JSONObject result = (JSONObject) p.parse(context.getAsString(&quot;result&quot;));</span>
<span class="nc" id="L372">				String filtered = finalReturn(category1, level, result);</span>
<span class="nc" id="L373">				System.out.println(&quot;................................indices selected.............&quot;); </span>
<span class="nc" id="L374">				String res1=&quot; \n&quot;;</span>
<span class="nc" id="L375">				res1+=filtered+&quot;\n Um ein weitere level fÃ¼r die Kategorie &quot;+ context.getAsString(&quot;category&quot;)</span>
				+ &quot; auswÃ¤hlen schreib: neue Level\n&quot;
				+&quot;Um die indizen eine neue Kategorie anzuschauen, schreib: neue Kategorie\n&quot;
				+&quot;Zum verlassen schreib einfach verlassen&quot;;
<span class="nc" id="L379">				chatResponse.put(&quot;text&quot;,res1);</span>
<span class="nc" id="L380">				chatResponse.put(&quot;closeContext&quot;, false);</span>
<span class="nc" id="L381">				return Response.ok().entity(chatResponse).build();</span>
			case &quot;new_Category&quot;:
<span class="nc bnc" id="L383" title="All 2 branches missed.">				if (context.getAsString(&quot;category&quot;) != null) {</span>
<span class="nc" id="L384">					context.remove(&quot;category&quot;);</span>
				}
<span class="nc bnc" id="L386" title="All 2 branches missed.">				if (context.getAsString(&quot;level&quot;) != null) {</span>
<span class="nc" id="L387">					context.remove(&quot;level&quot;);</span>
				}
<span class="nc" id="L389">				String res2 = selectCategoryMsg();</span>
<span class="nc" id="L390">				chatResponse.put(&quot;text&quot;,res2);</span>
<span class="nc" id="L391">				chatResponse.put(&quot;closeContext&quot;, false);</span>
<span class="nc" id="L392">				return Response.ok().entity(chatResponse).build();</span>
			case &quot;new_Level&quot;:
<span class="nc bnc" id="L394" title="All 2 branches missed.">				if (context.getAsString(&quot;level&quot;) != null) {</span>
<span class="nc" id="L395">					context.remove(&quot;level&quot;);</span>
				}
<span class="nc" id="L397">				String res3 = selectLevelMsg();</span>
<span class="nc" id="L398">				chatResponse.put(&quot;text&quot;,res3);</span>
<span class="nc" id="L399">				chatResponse.put(&quot;closeContext&quot;, false);</span>
<span class="nc" id="L400">				return Response.ok().entity(chatResponse).build();</span>



				/*case &quot;Diskursstruktur&quot;:
			          category = &quot;DISCOURSE&quot;;
			     case &quot;Morphologie&quot;:
			          category = &quot;MORPHOLOGY&quot;;
			     case &quot;Oberflaeche&quot;:
			          category = &quot;SURFACE&quot;;
			     case &quot;Syntax&quot;:
			          category=&quot;SYNTAX&quot;;
			     case &quot;Wortkomplexitaet&quot;:
			          category=&quot;WORD&quot;;*/
			default:
<span class="nc" id="L415">				String res4 =&quot;Intent kÃ¶nnte nicht ermitteln werden. Bitte Prozess neue beginnen.&quot;;</span>
<span class="nc" id="L416">				chatResponse.put(&quot;text&quot;,res4);</span>
<span class="nc" id="L417">				chatResponse.put(&quot;closeContext&quot;, false);</span>
<span class="nc" id="L418">				return Response.ok().entity(chatResponse).build();</span>
			}

		}
<span class="nc" id="L422">		catch (ChatException e) {</span>
<span class="nc" id="L423">			chatResponse.appendField(&quot;text&quot;, e.getMessage());</span>
<span class="nc" id="L424">			chatResponse.put(&quot;closeContext&quot;, false);</span>
<span class="nc" id="L425">			return Response.ok().entity(chatResponse).build();</span>
<span class="nc" id="L426">		} catch (Exception e) {</span>
<span class="nc" id="L427">			e.printStackTrace();</span>
<span class="nc" id="L428">			chatResponse.appendField(&quot;text&quot;, &quot;Sorry, ein unbekanntes Problem ist angekommen &quot;);</span>
<span class="nc" id="L429">			chatResponse.put(&quot;closeContext&quot;, true);</span>
<span class="nc" id="L430">			return Response.ok(chatResponse).build();</span>
		}
	}


	private String selectLevelMsg() {
		// TODO Auto-generated method stub
<span class="nc" id="L437">		Set&lt;String&gt; selection = new HashSet&lt;String&gt;();</span>
<span class="nc" id="L438">		selection.add(&quot;Dokument: Dokumentbezogene Indizes&quot;);</span>
<span class="nc" id="L439">		selection.add(&quot;Absatz:  Indizes bezogen auf den Absatz&quot;);</span>
<span class="nc" id="L440">		selection.add(&quot;Satz: Satzbezogene Indizes&quot;);</span>


<span class="nc" id="L443">		String response = &quot;Welche textlevel wÃ¼rdest du erst Ã¼berprÃ¼fen?\n&quot;</span>
				+ &quot;Du kannst dir eine aussuchen: \n&quot;;

<span class="nc" id="L446">		Iterator&lt;String&gt; it = selection.iterator();</span>
<span class="nc" id="L447">		int i = 1;</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">		while(it.hasNext()){</span>
<span class="nc" id="L449">			response += i + &quot;. &quot; + it.next() + &quot;\n&quot;;</span>
<span class="nc" id="L450">			i++;</span>
		}

<span class="nc" id="L453">		response += &quot;Bitte level eingeben&quot;;</span>
<span class="nc" id="L454">		return response;</span>
	}
	
	/**
	 * Filter Indices on Category and level
	 * @param category categoryname for the Indices function will match it to
	 * @param level levelname for the Indices function will match it to
	 * @return Indicevalue as jsonarray
	 * @throws ParseException
	 */
	private JSONArray selectIndices(String category, String level, JSONObject result) throws ParseException {
		
		// TODO Auto-generated method stub
<span class="nc" id="L467">		System.out.println(&quot;................in select indices................&quot;);</span>
<span class="nc" id="L468">		System.out.println(&quot;................................category = &quot;+ category); </span>
<span class="nc" id="L469">		System.out.println(&quot;................................level = &quot;+ level); </span>
<span class="nc" id="L470">		JSONParser p = new JSONParser(JSONParser.MODE_PERMISSIVE);</span>
<span class="nc" id="L471">		JSONObject data = (JSONObject) result.get(&quot;data&quot;);</span>
<span class="nc" id="L472">		JSONArray complexityIndices =(JSONArray) p.parse(data.getAsString(&quot;complexityIndices&quot;));</span>
<span class="nc" id="L473">		JSONArray results = new JSONArray();;</span>
<span class="nc bnc" id="L474" title="All 2 branches missed.">		for (Object item : complexityIndices) {</span>
<span class="nc" id="L475">			JSONObject obj = (JSONObject) item;</span>

<span class="nc bnc" id="L477" title="All 2 branches missed.">			if (obj.getAsString(&quot;category&quot;).matches(&quot;(?i).*&quot; + category + &quot;.*&quot;) ) {</span>
<span class="nc" id="L478">				JSONArray valencesIndices =(JSONArray) p.parse(obj.getAsString(&quot;valences&quot;));</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">				for(Object item2 : valencesIndices) {</span>
<span class="nc" id="L480">					JSONObject obj2 = (JSONObject) item2;</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">					if(obj2.getAsString(&quot;type&quot;).matches(&quot;(?i).*&quot; + level + &quot;.*&quot;)) {</span>
<span class="nc" id="L482">						System.out.println(&quot;................................category obj1 = &quot;+ obj.getAsString(&quot;category&quot;)); </span>
<span class="nc" id="L483">						System.out.println(&quot;................................level obj2= &quot;+ obj2.getAsString(&quot;type&quot;)); </span>
<span class="nc" id="L484">						results.add(obj2);</span>
					}
<span class="nc" id="L486">				}</span>
			}
<span class="nc" id="L488">		}</span>
<span class="nc" id="L489">		return results;</span>
	}
	
	private String finalReturn(String category, String level, JSONObject result) throws ParseException {
<span class="nc" id="L493">		JSONArray results= selectIndices( category,  level,  result);</span>
<span class="nc" id="L494">		IndiceDescription indice = new IndiceDescription();</span>
<span class="nc" id="L495">        JSONObject jsonObject = new JSONObject(result);</span>
<span class="nc" id="L496">        HashMap&lt;String,Integer&gt; hashMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L497">        String res=&quot;&quot;;</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">        for (Map.Entry&lt;String,String&gt; entry : indice.getIndiceMap().entrySet()) {</span>
<span class="nc" id="L499">        	int i=0;</span>
<span class="nc" id="L500">        	double sum=0;</span>
<span class="nc bnc" id="L501" title="All 2 branches missed.">	        for(Object item : results){</span>
<span class="nc" id="L502">	            JSONObject innerJsonObject = (JSONObject) item;</span>
<span class="nc bnc" id="L503" title="All 2 branches missed.">	            if(innerJsonObject.getAsString(&quot;index&quot;).matches(&quot;(?i).*&quot; + entry.getKey() + &quot;.*&quot;)) {</span>
<span class="nc" id="L504">	                sum+=Double.parseDouble(innerJsonObject.getAsString(&quot;value&quot;)); </span>
<span class="nc" id="L505">	                i+=1;</span>
	            }
<span class="nc" id="L507">	        }</span>
<span class="nc bnc" id="L508" title="All 2 branches missed.">	        if(i&gt;=1) {</span>
<span class="nc" id="L509">	        	res+=&quot;\n Durchschnitt der &quot;+ entry.getValue() + &quot;: &quot;+sum/i;</span>
	        }
	        
        	
<span class="nc" id="L513">        }</span>
<span class="nc" id="L514">        return res;</span>
		
	}

	private JSONObject getContext(String email, JSONParser p)
			throws ParseException{
		// TODO Auto-generated method stub
<span class="nc" id="L521">		Object obj = ContextInfo.get(email);</span>
<span class="nc bnc" id="L522" title="All 2 branches missed.">		if (obj instanceof JSONObject) {</span>
<span class="nc" id="L523">			JSONObject context = (JSONObject) (obj);</span>
<span class="nc" id="L524">			return context;</span>
		}
<span class="nc" id="L526">		return new JSONObject();</span>
	}

	/**
	 * function which extracts the category from the catagory types. If more than one row are provided a Chatexception is thrown
	 * @param mensas Resultset containing the mensas as rows
	 * @return Object containing the name and id of the mensa
	 * @throws ChatException the error message contains a list of mensas in the set
	 */
	private String selectCategoryMsg()
	{
<span class="nc" id="L537">		Set&lt;String&gt; selection = new HashSet&lt;String&gt;();</span>
<span class="nc" id="L538">		selection.add(&quot;Semantische Kohaesionsindizes: lokaler und globaler Zusammenhalt &quot;);</span>
<span class="nc" id="L539">		selection.add(&quot;Diskursstruktur-Indizes:  Textorganisation&quot;);</span>
<span class="nc" id="L540">		selection.add(&quot;Morphologische Indizes: Formen von WÃ¶rtern, insbesondere flektierte Formen&quot;);</span>
<span class="nc" id="L541">		selection.add(&quot;Isochrony (Sprechrhythmus)&quot;);</span>
<span class="nc" id="L542">		selection.add(&quot;Oberflaechenindizes: Form des Textes&quot;);</span>
<span class="nc" id="L543">		selection.add(&quot;Syntaktische Indizes: Anordnung von WÃ¶rtern und Phrasen&quot;);</span>
<span class="nc" id="L544">		selection.add(&quot;Wortkomplexitaetsindizes:  KomplexitÃ¤t von WÃ¶rtern Ã¼ber ihre Form hinaus&quot;);</span>

<span class="nc" id="L546">		String response = &quot;Der Text wurde bearbeitet, da die Classifiezirung noch nicht gemacht werden, kÃ¶nnen wir dir nur eine Zusammenfassung des wichtigsten induzen zeigen\n&quot;</span>
				+ &quot; welche aspecte der Text wÃ¼rdest du Ã¼berprÃ¼fen?\n&quot;
				+ &quot;Du kannst dir eine aussuchen: \n&quot;;

<span class="nc" id="L550">		Iterator&lt;String&gt; it = selection.iterator();</span>
<span class="nc" id="L551">		int i = 1;</span>
<span class="nc bnc" id="L552" title="All 2 branches missed.">		while(it.hasNext()){</span>
<span class="nc" id="L553">			response += i + &quot;. &quot; + it.next() + &quot;\n&quot;;</span>
<span class="nc" id="L554">			i++;</span>
		}

<span class="nc" id="L557">		response += &quot;Bitte Kategorie eingeben&quot;;</span>
<span class="nc" id="L558">		return response;</span>
	}

	



	/** Exceptions ,with messages, that should be returned in Chat */
	protected static class ChatException extends Exception {

		/**
		 *
		 */
		private static final long serialVersionUID = 1L;

		protected ChatException(String message) {
<span class="nc" id="L574">			super(message);</span>
			Context
<span class="nc" id="L576">			.get()</span>
<span class="nc" id="L577">			.monitorEvent(MonitoringEvent.SERVICE_CUSTOM_ERROR_3, message);</span>
<span class="nc" id="L578">		}</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>